name: DevSecOps Security Scan

on:
  schedule:
    - cron: '0 0 * * 0'  # ูู ุฃุณุจูุน
  workflow_dispatch:      # ุชุดุบูู ูุฏูู

jobs:
  security-audit:
    runs-on: ubuntu-latest
    
    steps:
    - name: ๐ฅ ุงุณุชูุณุงุฎ ุงูููุฏ
      uses: actions/checkout@v4

    - name: ๐ก๏ธ SAST - ุชุญููู ุซุงุจุช
      run: |
        echo "๐ ูุญุต ุงูููุฏ ุงูุซุงุจุช..."
        # ูุญุต ูููุงุช PHP
        find . -name "*.php" -type f | head -20 | xargs -I {} echo "โ {}"
        echo "๐ ุงูุจุญุซ ุนู ุฃููุงุท ุฎุทุฑุฉ..."
        
        # ุฃููุงุท ูุฌุจ ุชุฌูุจูุง
        PATTERNS=(
          "eval("
          "system("
          "shell_exec("
          "passthru("
          "exec("
          "phpinfo"
        )
        
        for pattern in "${PATTERNS[@]}"; do
          echo "๐ ุงูุจุญุซ ุนู: $pattern"
          grep -r "$pattern" --include="*.php" . || true
        done

    - name: ๐ ูุญุต ูููุงุช ุงูุชูููู
      run: |
        echo "๐ ูุญุต ูููุงุช ุงูุชูููู ููุฃูุงู..."
        
        # ูุญุต .env.example
        if [ -f ".env.example" ]; then
          echo "๐ ูุญุต .env.example"
          grep -v "^#" .env.example | grep -v "^$" || true
        fi
        
        # ูุญุต ุตูุงุญูุงุช ุงููููุงุช
        echo "๐ ูุญุต ุงูุตูุงุญูุงุช..."
        ls -la | grep -E "\.(php|sh|env)" || true

    - name: ๐ ุชูุฑูุฑ ุงูุฃูุงู ุงูุฃุณุจูุนู
      run: |
        echo "๐ ุชูุฑูุฑ ุงูุฃูุงู ุงูุฃุณุจูุนู"
        echo "======================"
        date
        echo ""
        echo "โ ุชู ูุญุต:"
        echo "  - ูููุงุช PHP"
        echo "  - ูููุงุช ุงูุชูููู"
        echo "  - ุตูุงุญูุงุช ุงููููุงุช"
        echo ""
        echo "๐ ุงูุชูุตูุงุช:"
        echo "  1. ุชุญุฏูุซ ุงูููุชุจุงุช ุจุงูุชุธุงู"
        echo "  2. ูุฑุงุฌุนุฉ ูููุงุช .env"
        echo "  3. ุงุฎุชุจุงุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู"
        echo ""
        echo "๐ AWS ู Terraform ุฌุงูุฒุงู ููุงุณุชุฎุฏุงู ุนูุฏ ุงูุญุงุฌุฉ"